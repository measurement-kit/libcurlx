name: mkcurl

dependencies:
- curl.haxx.se/ca
- github.com/adishavit/argh
- github.com/catchorg/catch2
- github.com/curl/curl
- github.com/measurement-kit/mkmock

build:
  executables:
    mkcurl-client:
    - mkcurl-client.cpp
    - mkcurl.cpp
    tests:
    - tests.cpp

tests:
  mocked_tests:
  - tests
  external_ca:
  - mkcurl-client --ca-bundle-path ./.mkbuild/etc/ca-bundle.pem
    https://www.kernel.org
  http11_test:
  - mkcurl-client https://ooni.torproject.org
  using_timeout:
  - mkcurl-client --timeout 10 --follow-redirect https://www.facebook.com
  http2_test:
  - mkcurl-client --enable-http2 https://www.google.com
  redirect_test:
  - mkcurl-client --follow-redirect http://google.com
  post:
  - mkcurl-client --post --data "{\"net-tests\":[]}" https://httpbin.org/post
  put:
  - mkcurl-client --put --data "{\"net-tests\":[]}" https://httpbin.org/put
  connect_to:
  - mkcurl-client --connect-to www.google.com https://www.youtube.com
  tcp-fastopen:
  - mkcurl-client --enable-tcp-fastopen https://www.kernel.org
